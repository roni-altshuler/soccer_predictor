# âš½ Soccer Stats Predictor

An AI-powered soccer match prediction system that analyzes over 150,000 historical matches from 9 major leagues to predict match outcomes and scorelines. Built with Next.js, FastAPI, and scikit-learn, featuring an intuitive web interface, comprehensive analytics, and upcoming matches calendar.

---

## âœ¨ Key Features

### ğŸ¯ Match Predictions

- **Win/Draw/Loss Probabilities:** Data-driven outcome predictions with confidence scores
- **Predicted Scorelines:** Estimated final score based on team performance patterns
- **Head-to-Head Mode:** Predict matches within the same league
- **Cross-League Mode:** Compare teams from different leagues (e.g., Man City vs Real Madrid)

### ğŸ“… Upcoming Matches

- **Automatic Predictions:** All scheduled matches pre-analyzed with predictions
- **Week View Calendar:** Sunday-Saturday weekly overview showing current and next week's matches
- **Historical View:** See past games from earlier in the week with their predictions
- **Day View Details:** Detailed predictions for each day's matches
- **Real-time Data:** Updated predictions for current season fixtures

### ğŸ“Š Advanced Analytics

- **Model Performance Metrics:** Confusion matrices, accuracy scores, F1 scores
- **Confidence Threshold Analysis:** 6 interactive charts showing precision/recall at different confidence levels
- **Feature Importance:** Understand which factors drive predictions
- **Prediction Distributions:** Visualize model output patterns across training and test sets

### ğŸ† 9 Major Leagues & Competitions

Premier League â€¢ La Liga â€¢ Serie A â€¢ Bundesliga â€¢ Ligue 1 â€¢ MLS â€¢ UCL â€¢ UEL â€¢ FIFA World Cup

---

## ğŸ¤– Machine Learning Architecture

### Model Specifications

- **Algorithm:** Random Forest Classifier (400 trees, max depth 20)
- **Training Data:** ALL historical data excluding current season (2025-2026)
  - Premier League: 51,648 matches (1888-2024)
  - La Liga/Bundesliga/Serie A: 13,000-15,000 matches (1988-2024)
  - Ligue 1: 13,319 matches (1995-2024)
  - MLS: 17,260 matches (1996-2024)
  - UCL/UEL: 10,000-18,000 matches (1990-2024)
  - World Cup: 2,078 matches (1930-2022)

### Training Strategy

- **Sample Weighting:** Exponential weighting on recent seasons
  - Last 5 seasons (2020-2024): 1.5x - 3.0x weight (~2.06x average)
  - Older seasons: 0.3x - 1.0x weight (~0.67x average)
- **Class Balancing:** Custom weights to combat draw bias
  - Win: 1.2 | Draw: 0.6 | Loss: 1.2
- **Feature Engineering:** Team form metrics (goals scored/conceded, win rates), attendance, head-to-head history

### Scoreline Prediction

Predicted scorelines are generated by analyzing each team's recent performance (last 2 seasons):

1. Calculate average goals scored/conceded for each team
2. Apply outcome-weighted adjustments (boost winner's goals, reduce loser's goals)
3. Balance with league averages for robustness

### Model Performance

| League         | Test Accuracy | Training Accuracy | Data Size      |
| -------------- | ------------- | ----------------- | -------------- |
| World Cup      | 69.7%         | 78.4%             | 2,078 matches  |
| Premier League | 51.7%         | 65.6%             | 51,648 matches |
| Bundesliga     | 53.1%         | 71.9%             | 14,804 matches |
| MLS            | 55.2%         | 76.1%             | 17,260 matches |

_Significantly better than random chance (33.3%) for three-way prediction_

---

## ğŸ› ï¸ Technologies Used

### Frontend

- **Next.js 14:** React framework with server-side rendering
- **TypeScript:** Type-safe JavaScript
- **Tailwind CSS:** Utility-first styling
- **Recharts:** Interactive data visualizations
- **date-fns:** Date manipulation for calendar views
- **SWR:** React Hooks for data fetching
- **Zustand:** Lightweight state management

### Backend

- **FastAPI:** High-performance Python API framework
- **Uvicorn:** ASGI server
- **Pydantic:** Data validation with type hints

### Machine Learning & Data Science

- **scikit-learn 1.7.2:** Random Forest models with custom weighting
- **Pandas:** Data manipulation and analysis
- **NumPy:** Numerical computing
- **Matplotlib & Seaborn:** Statistical visualizations
- **Joblib:** Model serialization

### Data Pipeline

- **Requests + BeautifulSoup:** Web scraping FBRef data
- **LXML:** Efficient HTML/XML parsing

---

## ğŸš€ Quick Start

### Prerequisites

- Python 3.12+
- Node.js 18+
- Git

### Installation

1. **Clone Repository**

```bash
git clone https://github.com/roni-altshuler/soccer_predictor.git
cd soccer_predictor
```

2. **Setup Python Environment**

```bash
python3 -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

3. **Install Node Dependencies**

```bash
npm install
```

4. **Generate Data and Train Models**

âš ï¸ **Important:** The repository does NOT include CSV data files or trained models (.pkl files) due to their large size. You must generate them locally:

```bash
# Step 1: Scrape data from FBRef (this will take some time)
./.venv/bin/python scripts/scrape_all_leagues.py
# When prompted, enter 'all' to scrape all leagues

# Step 2: Train models on the scraped data
./.venv/bin/python scripts/train_league_models.py
# When prompted, enter 'all' to train all leagues

# Step 3: Generate analytics visualizations
./.venv/bin/python scripts/analyze_model.py
# When prompted, enter 'all' to analyze all leagues
```

This process will create:

- `fbref_data/{league}/data/processed.csv` - Processed match data
- `fbref_data/{league}/models/model.pkl` - Trained Random Forest models
- `fbref_data/{league}/visualizations/*.png` - Performance charts

**Expected time:** ~30-60 minutes for all leagues (depends on internet speed and CPU)

5. **Run Application**

```bash
npm run dev
```

Access at `http://localhost:3000` ğŸ‰

---

## ğŸ“– Usage Guide

### Web Interface

**Making Predictions:**

1. Navigate to the **Predict** page
2. Select **Head-to-Head** or **Cross-League** mode
3. Choose league(s) and teams
4. Click **Predict** to see probabilities and predicted scoreline

**Viewing Upcoming Matches:**

1. Go to **Upcoming Matches** page
2. Select a league from the dropdown
3. Browse the week view calendar or click a day for details
4. All matches pre-loaded with predictions

**Exploring Analytics:**

1. Visit **Analytics** page
2. Select a league
3. View 11+ interactive visualizations:
   - Confusion matrices
   - Feature importance
   - Prediction distributions
   - Classification reports
   - Confidence threshold analysis (6 charts)

### Command Line

**Head-to-Head Prediction:**

```bash
python scripts/predict_and_analyze.py --mode head_to_head \
  --league premier_league \
  --home_team "Arsenal" \
  --away_team "Chelsea"
```

**Cross-League Prediction:**

```bash
python scripts/predict_and_analyze.py --mode cross_league \
  --league_a premier_league --team_a "Manchester City" \
  --league_b la_liga --team_b "Real Madrid"
```

**Season Simulation:**

```bash
python scripts/predict_and_analyze.py --mode season_simulation \
  --league premier_league \
  --simulations 10000
```

---

## ï¿½ Documentation

Comprehensive guides are available in the [`docs/`](./docs/) directory:

- **[Deployment Guide](./docs/DEPLOYMENT.md)** - Deploy to Vercel and production environments
- **[Troubleshooting](./docs/TROUBLESHOOTING.md)** - Common issues and solutions
- **[Retraining Guide](./docs/RETRAINING_GUIDE.md)** - How to retrain ML models with new data
- **[Auto-Update Scheduling](./docs/AUTO_UPDATE_SCHEDULING.md)** - Automated data updates
- **[Pre-commit Setup](./docs/PRECOMMIT_SETUP.md)** - Development workflow setup
- **[Frontend Setup](./docs/frontend-interface-setup.md)** - Frontend interface configuration

See the [docs README](./docs/README.md) for the full documentation index.

---

## ï¿½ğŸ“ Project Structure

```
soccer_predictor/
â”œâ”€â”€ backend/                      # FastAPI backend server
â”‚   â”œâ”€â”€ main.py                   # API routes for predictions
â”‚   â””â”€â”€ prediction_service.py     # ML prediction logic
â”œâ”€â”€ fbref_data/                   # League data and models
â”‚   â””â”€â”€ {league}/
â”‚       â”œâ”€â”€ data/                 # Raw and processed CSV files
â”‚       â”œâ”€â”€ models/               # Trained Random Forest models
â”‚       â””â”€â”€ visualizations/       # Generated PNG charts
â”œâ”€â”€ scripts/                      # Python pipeline scripts
â”‚   â”œâ”€â”€ scrape_all_leagues.py    # Data collection from FBRef
â”‚   â”œâ”€â”€ train_league_models.py   # Model training with weighting
â”‚   â”œâ”€â”€ analyze_model.py         # Generate visualizations
â”‚   â”œâ”€â”€ predict_and_analyze.py   # CLI prediction tool
â”‚   â””â”€â”€ cleanup_unused_visualizations.sh  # Remove unused PNGs
â”œâ”€â”€ src/                          # Next.js frontend (TypeScript)
â”‚   â”œâ”€â”€ app/                      # Route pages
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Home page
â”‚   â”‚   â”œâ”€â”€ predict/              # Prediction interface
â”‚   â”‚   â”œâ”€â”€ upcoming/             # Match calendar
â”‚   â”‚   â”œâ”€â”€ analytics/            # Visualizations dashboard
â”‚   â”‚   â””â”€â”€ about/                # Information page
â”‚   â””â”€â”€ components/               # React components
â”‚       â”œâ”€â”€ TeamSelector.tsx      # League/team form inputs
â”‚       â”œâ”€â”€ PredictionResult.tsx  # Display predictions
â”‚       â”œâ”€â”€ MLMetricsVisualizations.tsx  # Analytics charts
â”‚       â””â”€â”€ ...
â”œâ”€â”€ docs/                         # ğŸ“š Project documentation
â”‚   â”œâ”€â”€ README.md                 # Documentation index
â”‚   â”œâ”€â”€ DEPLOYMENT.md             # Deployment guide
â”‚   â”œâ”€â”€ TROUBLESHOOTING.md        # Common issues & solutions
â”‚   â”œâ”€â”€ RETRAINING_GUIDE.md       # Model retraining procedures
â”‚   â””â”€â”€ ...                       # Additional guides
â”œâ”€â”€ logs/                         # Application logs (gitignored)
â”œâ”€â”€ public/                       # Static assets
â”œâ”€â”€ .venv/                        # Python virtual environment
â”œâ”€â”€ package.json                  # Node.js dependencies
â”œâ”€â”€ requirements.txt              # Python dependencies
â”œâ”€â”€ next.config.js                # Next.js configuration
â”œâ”€â”€ tailwind.config.js            # Tailwind CSS configuration
â””â”€â”€ README.md                     # This file
```

---

## âš½ Supported Leagues

The application currently supports **5 major European leagues** with comprehensive historical data:

| League             | Country    | Seasons Available | Total Matches |
| ------------------ | ---------- | ----------------- | ------------- |
| **Premier League** | England ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ | 1888-2024         | 51,648        |
| **La Liga**        | Spain ğŸ‡ªğŸ‡¸   | 1928-2024         | 30,284        |
| **Bundesliga**     | Germany ğŸ‡©ğŸ‡ª | 1963-2024         | 18,972        |
| **Serie A**        | Italy ğŸ‡®ğŸ‡¹   | 1929-2024         | 29,516        |
| **Ligue 1**        | France ğŸ‡«ğŸ‡·  | 1932-2024         | 27,492        |

**Total:** 150,000+ historical matches analyzed

---

## ğŸ¤ Contributing

Contributions are welcome! Here's how you can help improve Soccer Stats Predictor:

**Ways to Contribute:**

- **Add More Leagues**: Extend support to additional soccer leagues worldwide
- **Feature Enhancements**: Implement new prediction algorithms or visualizations
- **Bug Fixes**: Report or fix issues you encounter
- **Data Quality**: Improve data scraping or preprocessing logic
- **Documentation**: Enhance guides, add examples, or translate content
- **Performance**: Optimize model training or frontend rendering

**Development Workflow:**

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes and test thoroughly
4. Commit with descriptive messages (`git commit -m 'Add scoreline prediction'`)
5. Push to your fork (`git push origin feature/amazing-feature`)
6. Open a Pull Request with a detailed description

**Code Standards:**

- Python: Follow PEP 8, add type hints
- TypeScript/React: Use functional components, proper typing
- Models: Document training parameters and evaluation metrics
- Components: Keep UI responsive and accessible

Questions or suggestions? Open an issue on GitHub!

---

---

<a name="acknowledgments-and-credits"></a>

## Acknowledgments and Credits

- **Data Source:** [FBRef](https://fbref.com) for providing comprehensive soccer statistics.
- **Inspiration:** This project was inspired by the desire to apply machine learning to the beautiful game of soccer.
- **Libraries & Frameworks:** A big thank you to the developers of all the open-source libraries and frameworks used in this project.

---

<a name="contact"></a>

## Contact

Roni Altshuler - [GitHub](https://github.com/roni-altshuler)

Project Link: [https://github.com/roni-altshuler/soccer_predictor](https://github.com/roni-altshuler/soccer_predictor)

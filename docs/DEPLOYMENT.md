# Vercel Deployment Guide

This guide will help you deploy the Soccer Stats Predictor to Vercel for production hosting.

## Prerequisites

- GitHub account
- Vercel account (free tier is sufficient)
- Trained models in `fbref_data/*/models/` directories
- Your repository pushed to GitHub

## Important Notes

⚠️ **Large File Warning**: The `fbref_data` folder contains CSV files and trained models that may exceed Vercel's limits. You have two options:

1. **Include data in repo** (current approach - works for <500MB total)
2. **Use cloud storage** (recommended for production - see Cloud Storage section below)

## Deployment Steps

### 1. Push to GitHub

```bash
git add .
git commit -m "Prepare for Vercel deployment"
git push origin main
```

### 2. Connect to Vercel

1. Go to [vercel.com](https://vercel.com)
2. Click "Add New Project"
3. Import your `soccer_predictor` repository
4. Vercel will auto-detect Next.js

### 3. Configure Build Settings

Vercel should auto-configure, but verify:

- **Framework Preset**: Next.js
- **Root Directory**: `./`
- **Build Command**: `npm run build`
- **Output Directory**: `.next`
- **Install Command**: `npm install`

### 4. Environment Variables

Add these in Vercel Dashboard → Settings → Environment Variables:

```bash
# Backend URL (will be auto-generated by Vercel)
NEXT_PUBLIC_BACKEND_URL=https://your-project.vercel.app

# Python version
PYTHON_VERSION=3.12

# Optional: If using cloud storage
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_S3_BUCKET=your-bucket-name
```

### 5. Deploy

Click **Deploy** and wait 2-5 minutes for the build to complete.

## Deployment Architecture

```
Vercel Edge Network
├── Next.js Frontend (Static + SSR)
│   └── Port 3000 → Vercel Serverless Functions
└── FastAPI Backend
    └── /api/* → Python Serverless Functions (Lambda)
```

## Limitations & Solutions

### Issue 1: Function Size Limits

**Problem**: Vercel has a 50MB limit per serverless function
**Solution**: The `vercel.json` config increases this to max (3GB memory, 50MB code)

```json
{
  "functions": {
    "backend/main.py": {
      "memory": 3008,
      "maxDuration": 60
    }
  }
}
```

### Issue 2: Cold Starts

**Problem**: First request after idle time takes 5-10 seconds
**Solution**:

- Implement loading spinners (already done ✅)
- Use Vercel Pro for edge caching
- Consider serverless warm-up pings

### Issue 3: Large Data Files

**Problem**: Git repos >500MB cause deployment failures
**Solution**: Use cloud storage (see next section)

## Cloud Storage Migration (Recommended)

For production, host data on AWS S3 or Google Cloud Storage:

### AWS S3 Approach

1. **Upload data to S3:**

```bash
aws s3 sync ./fbref_data s3://your-bucket/fbref_data --exclude "*.git/*"
```

2. **Update backend to load from S3:**

```python
import boto3
import pandas as pd
import joblib
from io import BytesIO

s3 = boto3.client('s3')

def load_from_s3(bucket, key):
    obj = s3.get_object(Bucket=bucket, Key=key)
    return obj['Body'].read()

# Load CSV
df = pd.read_csv(BytesIO(load_from_s3('your-bucket', 'fbref_data/premier_league/data/processed.csv')))

# Load model
model_bytes = load_from_s3('your-bucket', 'fbref_data/premier_league/models/model.pkl')
model = joblib.load(BytesIO(model_bytes))
```

3. **Add dependencies:**

```bash
pip install boto3
```

### Google Cloud Storage Approach

Similar to S3 but using `google-cloud-storage`:

```python
from google.cloud import storage
import pandas as pd

client = storage.Client()
bucket = client.bucket('your-bucket')

blob = bucket.blob('fbref_data/premier_league/data/processed.csv')
df = pd.read_csv(blob.open('rb'))
```

## Custom Domain

1. Go to Vercel Dashboard → Settings → Domains
2. Add your custom domain (e.g., `soccerpredictor.com`)
3. Follow DNS configuration instructions
4. Update `NEXT_PUBLIC_BACKEND_URL` environment variable

## Monitoring

Vercel provides:

- **Analytics**: Real-time visitor stats
- **Logs**: Function execution logs
- **Insights**: Performance metrics

Access in Dashboard → Analytics/Logs

## CI/CD

Auto-deployment is enabled by default:

- **Production**: Pushes to `main` branch → `your-project.vercel.app`
- **Preview**: PRs → `your-project-git-branch.vercel.app`

## Costs

### Free Tier Limits:

- 100GB bandwidth/month
- 100 hours serverless function execution
- 6,000 build minutes/month

### Hobby Plan ($0):

Perfect for this project unless you get 1000+ daily users

### Pro Plan ($20/month):

- Faster builds
- Edge caching
- Custom domains with SSL
- 1TB bandwidth

## Troubleshooting

### Build Fails: "Module not found"

```bash
# Ensure all dependencies in package.json
npm install
npm run build  # Test locally first
```

### API Routes 404

```bash
# Check vercel.json routes configuration
# Ensure backend/main.py uses ASGI for Vercel
```

### Cold Start Timeout

```javascript
// Increase fetch timeout in frontend
const response = await fetch(url, {
  signal: AbortSignal.timeout(30000), // 30 second timeout
});
```

### Large File Deployment

```bash
# Add to .gitignore
echo "fbref_data/*.csv" >> .gitignore
echo "fbref_data/*/visualizations/*.png" >> .gitignore

# Use Git LFS for models
git lfs track "*.pkl"
git add .gitattributes
```

## Alternative: Railway/Render

If Vercel doesn't work due to file sizes, try:

### Railway (Recommended Alternative)

1. Better for full-stack apps with large dependencies
2. Supports Docker containers
3. PostgreSQL integration
4. $5/month for hobby projects

### Render

1. Free tier includes web services
2. Supports Python/Node.js
3. Auto-deploy from GitHub
4. Better for long-running processes

## Production Checklist

- [ ] All models trained and committed
- [ ] Environment variables configured
- [ ] Loading states implemented
- [ ] Error handling added
- [ ] Analytics tracking setup (optional)
- [ ] Custom domain configured (optional)
- [ ] Monitoring/logging enabled
- [ ] README updated with live URL
- [ ] Pre-commit hooks installed
- [ ] Tests passing

## Post-Deployment

1. Test all features on production URL
2. Monitor function execution times
3. Check error logs daily for first week
4. Set up uptime monitoring (UptimeRobot, Pingdom)
5. Add Google Analytics (optional)

## Support

- Vercel Docs: https://vercel.com/docs
- Next.js Deployment: https://nextjs.org/docs/deployment
- FastAPI on Vercel: https://vercel.com/guides/using-fastapi-with-vercel

---

**Questions?** Open an issue on GitHub or check Vercel's community Discord.
